<!-- $theme: default -->
<!-- page_number: true -->
<!-- footer: COMP130017.03 Socket Project -->
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)

# åŸºäºUDPé€šä¿¡çš„ç½‘ç»œæ‹å–è¡ŒğŸ’°

**èƒ¡å¤©æ™“ 
14300240007	
14ä¿å¯†ç®¡ç†**

---
<!-- *page_number: false -->
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
# é¡¹ç›®ç®€ä»‹

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
## æ¦‚è¿°

æœ¬è½¯ä»¶å¯ä»¥å®ç°ç½‘ç»œæ‹å–åŠŸèƒ½ï¼Œåˆ†ä¸ºæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ã€‚åªèƒ½åŒæ—¶è¿è¡Œä¸€ä¸ªæœåŠ¡å™¨ç«¯ï¼Œä½†å¯ä»¥è¿è¡Œå¤šä¸ªå®¢æˆ·ç«¯ã€‚

Github: https://github.com/TianxiaoHu/AuctionOnline

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)

##  ç½‘ç»œç¯å¢ƒ

æœ¬ç¨‹åºçš„åº”ç”¨åœºæ™¯åŸºäºåˆ†ç»„ä¸¢å¤±ç‡éå¸¸å°çš„ç½‘ç»œç¯å¢ƒï¼Œä¸ºæ­¤é‡‡å–åŸºäºUDPçš„å®ç°ç­–ç•¥ã€‚

ä¸ºæ–¹ä¾¿æµ‹è¯•ï¼Œæ‰€æœ‰é€šä¿¡åœ¨æœ¬åœ°å›ç¯åœ°å€127.0.0.1ä¸Šè¿›è¡Œã€‚ç¨‹åºå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–ç½‘ç»œç¯å¢ƒï¼ŒæœåŠ¡å™¨ç«¯ç«¯å£ä¸º20210ï¼Œå®¢æˆ·ç«¯ç«¯å£ä¸º10000ï½65535ä¸­æŸä¸€éšæœºç«¯å£ã€‚

è‹¥åˆå§‹åŒ–æˆåŠŸï¼Œç¨‹åºç•Œé¢å‡ºç°åˆå§‹åŒ–æˆåŠŸæç¤ºï¼Œè‹¥å‡ºç°é”™è¯¯ï¼ˆå¦‚ç«¯å£å·è¢«å ç”¨ç­‰ï¼‰ï¼Œç¨‹åºå°†è‡ªåŠ¨é€€å‡ºã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
## ç¼–ç¨‹è¯­è¨€

æœ¬æ‹å–è¡Œä½¿ç”¨**python**è¿›è¡Œå¼€å‘ï¼Œpythonç‰ˆæœ¬ä¸º2.7.12ã€‚

é‡‡ç”¨è½»é‡çº§GUIåº“**Tkinter**è¿›è¡Œç”¨æˆ·å›¾å½¢åŒ–ç•Œé¢çš„äº¤äº’ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
## è¿è¡Œæ–¹å¼
#### Windows

ä¸ºæ–¹ä¾¿windows å¹³å°ä½¿ç”¨ï¼Œå·²ä½¿ç”¨pyinstalleræ‰“åŒ…ä¸ºç‹¬ç«‹çš„exeå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨æˆ·åŒå‡»server.exeæˆ–client.exeå³å¯è¿è¡Œã€‚

#### Mac/Linux

é¦–å…ˆåœ¨ç»ˆç«¯ä¸­æ›´æ”¹ç›®å½•åˆ°å½“å‰ç›®å½•ï¼š

```
$ cd directory/to/AuctionOnline
```

å¯åŠ¨æœåŠ¡å™¨ç«¯ï¼š

```
$ python server.py
```

```
$ python client.py
```
---

<!-- *page_number: false -->
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
# åŠŸèƒ½ä¸€è§ˆ

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
## æœåŠ¡å™¨ç«¯

ç¨‹åºå¯åŠ¨åï¼Œå¦‚æœåˆå§‹åŒ–æˆåŠŸï¼Œåˆ™ä¼šå¼¹å‡ºæç¤ºè¯­ï¼Œå¦‚æœå› ä¸ºæŸäº›åŸå› åˆå§‹åŒ–å¤±è´¥ï¼ˆå¦‚ç«¯å£å ç”¨ç­‰ï¼‰ï¼Œç¨‹åºå°†è‡ªåŠ¨é€€å‡ºã€‚

#### æ˜¾ç¤ºå¸®åŠ©

ç‚¹å‡»é¡µé¢ä¸Šæ–¹çš„`Help`æŒ‰é’®å³å¯æ˜¾ç¤ºæ”¯æŒçš„æœåŠ¡å™¨ç«¯æŒ‡ä»¤é›†åŠè¯¦ç»†ç”¨æ³•ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### æŒ‡ä»¤é›†

- `/auctions`

  ç”¨äºæŸ¥çœ‹å½“å‰æ‰€æœ‰æ‹å–æˆ¿é—´ã€‚

- `/opennewauction auctionname base gap`

  ç”¨äºåˆ›å»ºæ–°çš„æ‹å–æˆ¿é—´ï¼Œ`auctionname`ä¸ºæˆ¿é—´åï¼Œ`base`ä¸ºèµ·æ‹ä»·ï¼Œ`gap`ä¸ºæ¯æ¬¡å‡ºä»·æœ€ä½å¢åŠ çš„ä»·æ ¼ã€‚

- `/users`

  ç”¨äºåˆ—å‡ºå½“å‰æ‰€æœ‰åœ¨çº¿ç”¨æˆ·ã€‚

- `/list auctionname`

  ç”¨äºåˆ—å‡ºæŸæˆ¿é—´çš„æ‹å–ä¿¡æ¯ã€‚åŒ…æ‹¬ï¼šæˆ¿é—´åã€èµ·æ‹ä»·ã€æ¯æ¬¡ç«ä»·æœ€ä½å¢åŠ ä»·æ ¼ã€å½“å‰æœ€é«˜ä»·å‡ºä»·è€…ã€æˆ¿é—´å†…åœ¨çº¿ç”¨æˆ·ï¼ˆä¸åŒ…æ‹¬å·²ç»ç¦»å¼€çš„æ‹å–è€…ï¼‰åŠå‡ºä»·å†å²ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### æŒ‡ä»¤é›†
- `/msg username1 username2 ... | message`

  ç”¨äºå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œ`username`ä¸ºç”¨æˆ·ç™»å½•æ—¶çš„ç”¨æˆ·åã€‚æœ€åä¸€ä¸ªç”¨æˆ·åå’Œæ¶ˆæ¯ä¹‹é—´ç”¨`|`åˆ†éš”ã€‚

- `/broadcast auctionname message`

  ç”¨äºå¯¹æŸä¸ªæ‹å–æˆ¿é—´è¿›è¡Œæˆ¿é—´å¹¿æ’­ï¼Œæ‰€æœ‰åœ¨æˆ¿é—´ä¸­çš„ç”¨æˆ·ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚

- `/kickout username1 username2 ...`

  ç”¨äºè¸¢å‡ºæˆ¿é—´å†…ç”¨æˆ·ï¼Œæ”¯æŒåŒæ—¶è¸¢å‡ºå¤šäººï¼Œä½†ä¸èƒ½è¸¢å‡ºå½“å‰å‡ºä»·æœ€é«˜çš„ç”¨æˆ·ï¼ˆæ‹å–å·²ç»“æŸçš„æˆ¿é—´é™¤å¤–ï¼‰ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### æŒ‡ä»¤é›†
- `/finish auctionname`

  ç”¨äºç»“æŸæˆ¿é—´å†…æ‹å–ã€‚æˆ¿é—´å†…æ‹å–ç»“æŸåï¼Œæˆ¿é—´ç›¸å½“äºè¢«é”å®šã€‚ç”¨æˆ·æ— æ³•ç»§ç»­å‡ºä»·ï¼Œä¸åœ¨æˆ¿é—´å†…çš„ç”¨æˆ·å°†æ— æ³•å†åŠ å…¥æˆ¿é—´ï¼Œæˆ¿é—´å†…çš„æ‰€æœ‰ç”¨æˆ·éƒ½å¯è¢«æœåŠ¡å™¨è¸¢å‡ºï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨`/leave`æŒ‡ä»¤ç¦»å¼€æˆ¿é—´ã€‚

- `/close auctionname`

  ç”¨äºå…³é—­æ‹å–æˆ¿é—´å¹¶ä»æœåŠ¡å™¨ç«¯åˆ é™¤è¯¥æˆ¿é—´çš„å†å²ä¿¡æ¯ã€‚æ‹å–æˆ¿é—´å†…å¿…é¡»æ²¡æœ‰ä»»ä½•ç”¨æˆ·ã€‚

- `/restart auctionname`

  ç”¨äºé‡æ–°å¯åŠ¨æŸæˆ¿é—´å†…çš„æ‹å–ã€‚æˆ¿é—´å†…æ‰€æœ‰æ‹å–å†å²å°†è¢«æ¸…ç©ºï¼Œæ‹å–ä¿¡æ¯è¢«è¿˜åŸä¸ºåˆå§‹ä¿¡æ¯ã€‚
  **æˆ¿é—´å†…æ‰€æœ‰ç”¨æˆ·å°†æ”¶åˆ°æ‹å–å·²é‡å¯çš„æç¤ºä¿¡æ¯ã€‚**
  å·²ç»åœ¨æˆ¿é—´å†…çš„ç”¨æˆ·ä¸ä¼šè¢«è¸¢å‡ºã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### ä¼ è¾“æ—¥å¿—

ä¸ºæ–¹ä¾¿å†å²è¿½æº¯åŠå®¢æˆ·ç«¯åŠ¨ä½œè®°å½•ä¸æ ¸å¯¹ï¼ŒæœåŠ¡å™¨ç«¯è®¾ç½®äº†ä¼ è¾“æ—¥å¿—çª—å£ï¼Œå¯ä»¥æ˜¾ç¤ºå‡ºæ¯ä¸ªç”¨æˆ·çš„ç½‘ç»œåœ°å€åŠä¸æœåŠ¡å™¨äº¤äº’çš„è¯¦ç»†åŠ¨ä½œä¿¡æ¯ã€‚

å½“ä¼ è¾“æ—¥å¿—çª—å£ä¿¡æ¯è¿‡å¤šæ—¶ï¼Œå¯ä»¥ç‚¹å‡»`Clear log`æŒ‰é’®æ¸…ç©ºæ—¥å¿—ã€‚

#### é€€å‡ºç¨‹åº

ç‚¹å‡»`Exit`æŒ‰é’®å³å¯é€€å‡ºç¨‹åºï¼Œé‡Šæ”¾å†…å­˜ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
## å®¢æˆ·ç«¯

#### æ˜¾ç¤ºå¸®åŠ©

ç‚¹å‡»é¡µé¢ä¸Šæ–¹çš„`Help`æŒ‰é’®å³å¯æ˜¾ç¤ºæ”¯æŒå®¢æˆ·ç«¯æŒ‡ä»¤é›†åŠè¯¦ç»†ç”¨æ³•ã€‚

è‹¥ç”¨æˆ·è¾“å…¥äº†é”™è¯¯çš„æŒ‡ä»¤æˆ–æŒ‡ä»¤æ ¼å¼ï¼ŒæœåŠ¡å™¨ç«¯ä¼šåé¦ˆç”¨æˆ·*Invalid input*æç¤ºä¿¡æ¯ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### æŒ‡ä»¤é›†

- `/login username`

  ç”¨äºä»¥`username`èº«ä»½ç™»å½•åˆ°æœåŠ¡å™¨ç«¯ã€‚

- `/auctions`

  ç”¨äºæŸ¥çœ‹å½“å‰æ‰€æœ‰æ‹å–æˆ¿é—´ã€‚

- `/join auctionname`

  ç”¨äºåŠ å…¥æŸä¸ªæ‹å–æˆ¿é—´ï¼Œæ³¨æ„æ¯ä¸ªç”¨æˆ·åªèƒ½åŒæ—¶åœ¨ä¸€ä¸ªæˆ¿é—´å†…ã€‚
  **æˆ¿é—´å†…æ‰€æœ‰åœ¨çº¿ç”¨æˆ·å°†ä¼šæ”¶åˆ°æœ‰äººåŠ å…¥çš„ä¿¡æ¯ã€‚**
  
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### æŒ‡ä»¤é›†
- `/list`

  ç”¨äºæŸ¥çœ‹å½“å‰æˆ¿é—´ä»·æ ¼ä¿¡æ¯åŠå‡ºä»·å†å²ã€‚

- `/bidders`

  ç”¨äºæŸ¥çœ‹å½“å‰æˆ¿é—´çš„æ‰€æœ‰åœ¨çº¿ç”¨æˆ·ã€‚

- `/bid price`

  ç”¨äºä¸ºå½“å‰æˆ¿é—´æ‹å–ç‰©å“å‡ºä»·ã€‚
  **æˆ¿é—´å†…æ‰€æœ‰ç”¨æˆ·å°†ä¼šæ”¶åˆ°å‡ºä»·ä¿¡æ¯ã€‚**

- `/pubmsg message`

  ç”¨äºå‘å½“å‰æˆ¿é—´å†…æ‰€æœ‰åœ¨çº¿ç”¨æˆ·ç»Ÿä¸€å‘é€æˆ¿é—´å†…å…¬å¼€æ¶ˆæ¯ã€‚
  
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### æŒ‡ä»¤é›†
- `/primsg username1 username2 ... | message`

  ç”¨äºå‘ä»»æ„ä¸ªå½“å‰æˆ¿é—´å†…çš„ç”¨æˆ·å‘é€ç§äººæ¶ˆæ¯ã€‚æ³¨æ„æœ€åä¸€ä¸ª`username`å’Œ`message`ä¹‹é—´éœ€è¦ç”¨`|`åˆ†éš”ã€‚

- `/leave`

  ç”¨äºé€€å‡ºå½“å‰æˆ¿é—´ï¼Œä½†åœ¨å½“å‰æˆ¿é—´æ‹å–æœªç»“æŸä¸”å½“å‰ç”¨æˆ·å‡ºä»·æœ€é«˜æ—¶æ— æ³•é€€å‡ºã€‚
  **æˆ¿é—´å†…æ‰€æœ‰ç”¨æˆ·å°†ä¼šæ”¶åˆ°æœ‰äººç¦»å¼€æˆ¿é—´çš„æ¶ˆæ¯ã€‚**

- `/exit`

  ç”¨äºé€€å‡ºç™»å½•å¹¶æ°¸ä¹…æ¸…é™¤æœåŠ¡å™¨ç«¯æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚è‹¥ç”¨æˆ·åœ¨æˆ¿é—´å†…åˆ™ä¼šè‡ªåŠ¨æ‰§è¡Œ`/leave`æŒ‡ä»¤ï¼Œ**æˆ¿é—´å†…æ‰€æœ‰ç”¨æˆ·å°†ä¼šæ”¶åˆ°å…¶é€€å‡ºçš„æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ç«¯ä¹Ÿä¼šæ”¶åˆ°ç”¨æˆ·é€€å‡ºç™»å½•çš„æ¶ˆæ¯**ã€‚
  åœ¨å½“å‰æˆ¿é—´æ‹å–æœªç»“æŸä¸”å½“å‰ç”¨æˆ·å‡ºä»·æœ€é«˜æ—¶æ— æ³•é€€å‡ºã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### é€€å‡ºç¨‹åº

å½“ç”¨æˆ·æ‰§è¡Œå®Œ`/exit`æŒ‡ä»¤åï¼Œç‚¹å‡»`Exit`æŒ‰é’®å³å¯é€€å‡ºç¨‹åºï¼Œé‡Šæ”¾å†…å­˜ã€‚

---
<!-- *page_number: false -->
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
# ä»£ç ç»“æ„

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
## æœåŠ¡å™¨ç«¯

#### å…¨å±€å˜é‡

```python
global AuctionRoom, User, AddMapID, IDMapAdd
AuctionRoom, User = [], []
AddMapID, IDMapAdd = {}, {}
```

ä¸ºæ–¹ä¾¿è°ƒç”¨ï¼Œæœ‰å…³ç”¨æˆ·åŠæˆ¿é—´çš„ä¿¡æ¯è¢«å­˜å‚¨åœ¨å…¨å±€å˜é‡ä¸­ã€‚ç”±äºæ¯ä¸ªç”¨æˆ·æœ‰åœ°å€ï¼ˆå”¯ä¸€ï¼‰å’Œç”¨æˆ·åä¸¤ç§æ ‡è¯†ï¼Œå› æ­¤ç”¨ä¸¤ä¸ªå…¨å±€å­—å…¸å­˜å‚¨å…¶ç›¸å¯¹åº”å…³ç³»ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### AESåŠ å¯†æ¨¡å—

è€ƒè™‘åˆ°æœ‰å¿…è¦å¯¹æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å¯¹è¯è¿›è¡ŒåŠ å¯†ä»¥é˜²æ­¢ä¸­é—´äººï¼ˆMITMï¼‰æ”»å‡»ï¼Œæ•…é‡‡ç”¨AESåŠ å¯†å¯¹æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å›è¯è¿›è¡Œå¤„ç†ã€‚

é‡‡ç”¨æˆç†Ÿçš„pythonåŠ å¯†æ¨¡å—**Crypto**è¿›è¡ŒåŠ å¯†ã€‚

ç”±äºCryptoä¸­çš„AESæ¨¡å—åªèƒ½å¯¹å­—ç¬¦æ•°ä¸º16çš„æ•´æ•°å€çš„å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†ï¼Œå› æ­¤åœ¨è°ƒç”¨ä¹‹å‰éœ€è¦å°†å…¶å…ˆç”¨`'\0'`å¡«å……è‡³16çš„æ•´æ•°å€é•¿åº¦å†è¿›è¡Œä¼ è¾“ã€‚åŒç†ï¼Œæ¥æ”¶ä¹‹åä¹Ÿéœ€è¦å»é™¤å…¶ä¸­çš„å¡«å……å­—ç¬¦ã€‚

åœ¨æ¥ä¸‹æ¥æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å›è¯è¿‡ç¨‹ä¸­ï¼Œå‘é€ä¹‹å‰å‡å…ˆç”¨ç»Ÿä¸€å¯†é’¥åŠ å¯†ï¼Œæ¥æ”¶åå†è§£å¯†ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### AESåŠ å¯†æ¨¡å—
```python
from Crypto.Cipher import AES

padding = '\0'
pad = lambda x: x + (16 - len(x) % 16) * padding
unwrap = lambda x: x.replace('\0', '')
key = '1234567890abcdef'
mode = AES.MODE_ECB
encryptor = AES.new(key, mode)
decryptor = AES.new(key, mode)

def AESencrypt(plaintext):
    plaintext = pad(plaintext)
    return encryptor.encrypt(plaintext)

def AESdecrypt(ciphertext):
    plaintext = decryptor.decrypt(ciphertext)
    return unwrap(plaintext)
```
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Roomç±»

å½“æœåŠ¡å™¨ç«¯åˆ›å»ºäº†æ–°çš„æ‹å–æˆ¿é—´æ—¶ï¼Œå°†ä¼šåˆå§‹åŒ–ä¸€ä¸ªRoomç±»çš„ç¤ºä¾‹ï¼Œå¹¶å°†å…¶æˆ¿é—´åæ·»åŠ åˆ°å…¨å±€åˆ—è¡¨AuctionRoomä¸­ã€‚

ä¸‹é¢åˆ—å‡ºRoomç±»çš„åˆå§‹åŒ–å‡½æ•°ç»†èŠ‚ï¼Œå…¶ä»–ç±»æ¥å£ä»…åˆ—å‡ºå‡½æ•°ååŠå‚æ•°ï¼Œå…·ä½“å¯ä»¥å‚è§pythonæºä»£ç ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Roomç±»
```python
class Room():

    def __init__(self, name, baseprice, gap):
        self.name = name
        self.bidder = []
        self.history = []
        self.base_price = float(baseprice)
        self.highest_price = float(baseprice)
        self.highest_user = ''
        self.gap = float(gap)
        self.closed = False
```

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Roomç±»
```python
class Room():

    def add_bidder(self, bidder_ID):
        pass
        
    def remove_bidder(self, bidder_ID):
        pass
    
    def draw_bid_history(self):
        pass
    
    def draw_bidder_address(self):
        pass
    
    def draw_bidder_ID(self):
        pass

    def update_bid_info(self, UserID, price):
        pass
```
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Serverç±»

å½“æœåŠ¡å™¨ç«¯å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ªServerç±»ï¼Œè‹¥åˆå§‹åŒ–æˆåŠŸï¼Œåˆ™å±å¹•ä¸Šå°†å‡ºç°æˆåŠŸçš„æç¤ºæ¶ˆæ¯ï¼Œè‹¥å¤±è´¥ï¼Œåˆ™ç¨‹åºä¼šå¼¹å‡ºæç¤ºåè‡ªåŠ¨é€€å‡ºã€‚

æœåŠ¡å™¨ç«¯å®šä¹‰äº†ä¸‰ä¸ªæœ‰å…³æ•°æ®æ”¶å‘çš„æ¥å£ï¼Œåˆ†åˆ«ä¸º

- send_message

  ç”¨äºå‘æŸä¸€IPåœ°å€å‘é€æ¶ˆæ¯ã€‚

- receive_message

  ç”¨äºç›‘å¬å®¢æˆ·ç«¯ä¼ æ¥çš„æ¶ˆæ¯ã€‚

- broadcast

  ç”¨äºå‘å¤šä¸ªIPåœ°å€æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œå¸¸ç”¨äºæˆ¿é—´å†…å¹¿æ’­ç­‰ã€‚
  
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Serverç±»
ä¸‹é¢åˆ—å‡ºServeråˆå§‹åŒ–ç»†èŠ‚åŠæ•°æ®æ”¶å‘æ¥å£çš„å®ç°ã€‚

```python
import socket

class Server():
    def __init__(self, local_port=20210):
        try:
            local_IP = '127.0.0.1'
            local_address = (local_IP, local_port)
            self.s = socket.socket(socket.AF_INET, 
                                   socket.SOCK_DGRAM)
            self.s.bind(local_address)
            window.feedback_message.insert(1.0, 
           	 'AuctionOnline Server Initialized!\n')

        except:
            window.feedback_message.insert(1.0, 
            	'Fail to create Server UDP socket...\n')
            time.sleep(2)
            sys.exit()
```

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Serverç±»

```python
class Server():

    def receive_message(self):
        message, address = self.s.recvfrom(2048)
        plaintext = AESdecrypt(message)
        window.log_message.insert(1.0, 'received: ' + 
            plaintext + ' from '+ str(address) + '\n')
        return plaintext, address

    def send_message(self, message, address):
        ciphertext = AESencrypt(message)
        self.s.sendto(ciphertext, address)
        window.log_message.insert(1.0, message + 
                     ' send to ' + str(address) + '\n')

    def broadcast(self, message, client_addresses):
        window.log_message.insert(1.0, 
                            'Broadcasting ended!\n')
        for client_address in client_addresses:
            self.send_message(message, client_address)
        window.log_message.insert(1.0, 
                            'Broadcasting...\n')
```
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Serverç±»
```python
class Server():

    def deal_client_command(self, message, address):
        fields = message.split(' ')
        if fields[0] in ['/login', '/auctions', '/join', 
                         '/list', '/bidders', '/bid',
                         '/pubmsg', '/primsg','/leave', 
                         '/exit']:
            if fields[0] == '/login':
                pass
                
            if fields[0] == '/auctions':
                ... ...
           
        else:
            self.send_message('Invalid input!', address)
```
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Serverç±»
```python
class Server():

    def deal_server_command(self, message):
        window.command_entry.delete(0, END)
        window.error_label['text'] = ''
        fields = message.split(' ')
        if fields[0] in ['/msg', '/list', '/kickout', 
                         '/restart', '/opennewauction',     
                         '/auctions','/users', '/finish', 
                         '/close', '/broadcast']:
            if fields[0] == '/msg':
                pass
                
            if fields[0] == '/list':
                ... ...
                 
        else:
            window.error_label['text'] = 'Invalid input!'
```
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### GUI

é‡‡ç”¨è½»é‡çº§å›¾å½¢ç•Œé¢åº“Tkinterï¼Œç”±`Button`ã€`Entry`ã€`Text`ã€`Label`å’Œ`MessageBox`ç»„ä»¶æ„æˆã€‚

#### å¤šçº¿ç¨‹

ç¨‹åºéœ€è¦ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œï¼Œä¸»çº¿ç¨‹ç”¨äºå¤„ç†æœåŠ¡å™¨ç«¯è¾“å…¥çš„æŒ‡ä»¤ï¼Œå¦å¤–å¼€å¯ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨ç”¨äºå¾ªç¯ç›‘å¬ç«¯å£ï¼Œå¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯ã€‚

`ListennerThread`ç»§æ‰¿è‡ª`threading.Thread`ï¼Œå°†å…¶åˆå§‹åŒ–æ–¹å¼é‡è½½ä¸ºç›‘å¬ç«¯å£ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### å¤šçº¿ç¨‹
```python
import threading

class ListenerThread(threading.Thread):
    def run(self):
        while True:
            data, address = server.receive_message()
            server.deal_client_command(data, address)
            
if __name__ == '__main__':
    listener_thread = ListenerThread()
    listener_thread.setDaemon(True)
    listener_thread.start()
    window.root.mainloop()
```

åœ¨ä¸»çº¿ç¨‹ä¸­å°†å­çº¿ç¨‹è®¾ä¸ºä¸ä¸»çº¿ç¨‹åŒæ—¶ç»“æŸï¼ŒåŒæ—¶å¯åŠ¨GUIçº¿ç¨‹å¤„ç†æœåŠ¡å™¨ç«¯çš„æŒ‡ä»¤ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
### å®¢æˆ·ç«¯

å®¢æˆ·ç«¯ç»“æ„ç›¸å¯¹äºæœåŠ¡å™¨ç«¯ç»“æ„è¾ƒä¸ºç®€å•ï¼Œç”±äºå®¢æˆ·ç«¯ä¸ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼Œæ•…å…¶æ²¡æœ‰æœåŠ¡å™¨ç«¯çš„å…¨å±€å˜é‡å’ŒRoomç±»ã€‚

å®¢æˆ·ç«¯ä¸­çš„AESåŠ å¯†æ¨¡å—ã€GUIã€å¤šçº¿ç¨‹å’ŒæœåŠ¡å™¨ç«¯é€»è¾‘ç›¸åŒæˆ–ç›¸ä¼¼ï¼Œæ­¤å¤„çœç•¥ã€‚

---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
#### Clientç±»

å½“å®¢æˆ·ç«¯å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ªClientç±»ï¼Œè‹¥åˆå§‹åŒ–æˆåŠŸï¼Œåˆ™å±å¹•ä¸Šå°†å‡ºç°æˆåŠŸçš„æç¤ºæ¶ˆæ¯ï¼Œè‹¥å¤±è´¥ï¼Œåˆ™ç¨‹åºä¼šè‡ªåŠ¨é€€å‡ºã€‚

å®¢æˆ·ç«¯åªå®šä¹‰äº†ä¸¤ä¸ªå…³äºæ•°æ®æ”¶å‘çš„æ¥å£ï¼Œåˆ†åˆ«ä¸º

- send_message

  ç”¨äºå‘æœåŠ¡å™¨ç«¯å‘é€æ¶ˆæ¯ã€‚

- receive_message

  ç”¨äºç›‘å¬æœåŠ¡å™¨ç«¯ä¼ æ¥çš„æ¶ˆæ¯ã€‚
  
---
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
## å…¶ä»–

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»“åˆå®é™…åº”ç”¨åœºæ™¯å¯¹æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æŒ‡ä»¤é›†è¿›è¡Œäº†ä¿®æ”¹ä¸æ‰©å……ï¼Œå¦‚å–æ¶ˆäº†æœåŠ¡å™¨ç«¯çš„`/enter`æŒ‡ä»¤ï¼Œæ”¹ä¸ºæ›´åŠ è¯¦ç»†çš„`/list`æŒ‡ä»¤ï¼Œä»¥åŠè®¾ç½®`/kickout`ç­‰æŒ‡ä»¤å¯ä»¥ç›´æ¥æŒ‡å®šæˆ¿é—´åä½œä¸ºå‚æ•°ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¢åŠ äº†ä¸€äº›å®ç”¨æ€§çš„åŠŸèƒ½å¦‚æˆ¿é—´å†…å¹¿æ’­ã€ç”¨æˆ·ç§ä¿¡ç­‰ã€‚

---
<!-- *page_number: false -->
![bg 110%](http://pic.qiantucdn.com/58pic/19/37/05/10G58PICy7e_1024.jpg)
# Thank you for listening â¤ï¸